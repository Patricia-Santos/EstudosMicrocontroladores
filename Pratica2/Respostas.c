/*
 * Projeto: Todos os projetos da segunda prática
 * Placa: STM32F4VEx
 * Descrição: Programação de DAC e ADC no STM32F407
 * Autores: Patricia Santos e Richard Ferreira
*/

#include "stm32f4xx.h" //bibliotecas padrão STM32F4
#include "Utility.h"   //Incluindo biblioteca para usar a funções adicionais
#include <stdlib.h>    //necessário para usar as funções printf e scanf

//definindo os pinos como ligado ou desligado
#define PINO_4_ON GPIOA->ODR |= (1<<4) //Liga pino 4 do gpioA
#define PINO_4_OFF GPIOA->ODR &= ~(1<<4) //Desliga o pino 4 do gpioA

//Desligar todos os pinos da porta A
#define PINOS_A_OFF PINO_4_OFF;

//Criando lista senoide
const mask[200]={1861,2357,1861,1365,1861};
const uint16_t samples[200]={
1861(0); 1876,579723347441(1); 1892,1440714148723(2); 1907,6776840958046(3); 1923,165231615812(4); 1938,5914296611454(5); 1953,9410544624766(6); 1969,1989578188977(7); 1984,350082047341(8); 1999,3794748426662(9); 2014,272304033761(10); 2029,0138722210722(11); 2043,589631281145(12); 2057,9851967238383(13); 2072,1863618880557(14); 2086,17911196198(15); 2099,9496378139816(16); 2113,484349620535(17); 2126,769890277715(18); 2139,793148583024(19); 2152,541272174541(20); 2165,001680214633(21); 2177,162075805699(22); 2189,010458125704(23); 2200,535134271524(24); 2211,7247307984044(25); 2222,568204944164(26); 2233,0548555270448(27); 2243,174333506472(28); 2252,9166521962893(29); 2262,2721971203937(30); 2271,231735501051(31); 2279,786425370513(32); 2287,927824296959(33); 2295,647897716144(34); 2302,939026860529(35); 2309,7940162780706(36); 2316,206100933255(37); 2322,1689528833567(38); 2327,676687523345(39); 2332,7238693932686(40); 2337,3055175423897(41); 2341,4171104447714(42); 2345,0545904614714(43); 2348,2143678449365(44); 2350,8933242816397(45); 2353,0888159694796(46); 2354,7986762268843(47); 2356,0212176310642(48); 2356,7552336832914(49); 2356,9999999995634(50); 2356,7552750254863(51); 2356,0213002746545(52); 2354,7988000903106(53); 2353,0889809305036(54); 2350,8935301774654(55); 2348,2146144723697(56); 2345,0548775771217(57); 2341,41743776529(58); 2337,305884744752(59); 2332,7242761150906(60); 2327,677133363242(61); 2322,169437401339(62); 2316,2066236511628(63); 2309,7945766800453(64); 2302,939624393522(65); 2295,6485317904644(66); 2287,928494286852(67); 2279,787130614781(68); 2271,2324753037046(69); 2262,272970751338(70); 2252,917458892045(71); 2243,1751724709293(72); 2233,0557259322486(73); 2222,5691059311307(74); 2211,725661477971(75); 2200,5360937252226(76); 2189,0114454066716(77); 2177,1630899396096(78); 2165,002720200661(79); 2152,542336986348(80); 2139,7942371697704(81); 2126,771001565099(82); 2113,485482511852(83); 2099,950791191207(84); 2086,1802846868713(85); 2072,187552803277(86); 2057,986404654102(87); 2043,5908550343718(88); 2029,015110589567(89); 2014,273555795406(90); 1999,3807387621264(91); 1984,351356877282(92); 1969,2002423012186(93); 1953,9423473295503(94); 1938,5927296370705(95); 1923,1665374176719(96); 1907,6789944349318(97); 1892,145384998123(98); 1876,581038878469(99); 1861,0013161805375(100); 1845,4215921836972(101); 1829,8572421685978(102); 1814,3236262436515(103); 1798,8360741864853(104); 1783,4098703153263(105); 1768,0602384052518(106); 1752,8023266641849(107); 1737,6511927834688(108); 1722,621789077768(109); 1707,7289477289637(110); 1692,9873661486058(111); 1678,411592473367(112); 1664,016011207812(113); 1649,8148290286524(114); 1635,8220607644962(115); 1622,051515564926(116); 1608,5167832725601(117); 1595,2312210115406(118); 1582,2079400056855(119); 1569,4597926393185(120); 1556,999359773536(121); 1544,8389383304382(122); 1532,9905291575726(123); 1521,4658251845653(124); 1510,276199883631(125); 1499,432696045349(126); 1488,9460148807789(127); 1478,8265054606763(128); 1469,0841545022265(129); 1459,7285765133759(130); 1450,769004304491(131); 1442,2142798767043(132); 1434,0728456959405(133); 1426,3527363612366(134); 1419,0615706755764(135); 1412,2065441270638(136); 1405,7944217878576(137); 1399,8315316378723(138); 1394,3237583198372(139); 1389,2765373318744(140); 1384,6948496633263(141); 1380,5832168791305(142); 1376,9456966575872(143); 1373,7858787859282(144); 1371,1068816176355(145); 1368,9113489950098(146); 1367,2014476400188(147); 1365,9788650160112(148); 1365,2448076623946(149); 1365,0000000039292(150); 1365,24468363581(151); 1365,9786170852412(152); 1367,2010760497405(153); 1368,9108541119372(154); 1371,106263930158(155); 1373,7851389036275(156); 1376,9448353106368(157); 1380,5822349175742(158); 1384,69374805624(159); 1389,2753171664094(160); 1394,3224208001477(161); 1399,8300780839263(162); 1405,792853634135(163); 1412,2048629211406(164); 1419,0597780765966(165); 1426,3508341382762(166); 1434,0708357262608(167); 1442,2121641438996(168); 1450,7667848965305(169); 1459,726255620543(170); 1469,0817344149589(171); 1478,823988567304(172); 1488,9434036651674(173); 1499,4299930844486(174); 1510,2734078449332(175); 1521,4629468234702(176); 1532,9875673146707(177); 1544,835895928706(178); 1556,9962398154516(179); 1569,4565982038985(180); 1582,2046742454465(181); 1595,2278871493882(182); 1608,5133845986086(183); 1622,0480554332503(184); 1635,8185425898232(185); 1649,8112562829897(186); 1664,0123874170217(187); 1678,4079212136876(188); 1692,983651043121(189); 1707,7251924440282(190); 1722,617997319388(191); 1737,647368293646(192); 1752,7984732172224(193); 1768,05635980403(194); 1783,4059703875507(195); 1798,8321567809066(196); 1814,3196952262697(197); 1829,8533014188456(198); 1845,4176455906122(199)};

const uint16_t samples[100]={
		2048, 2176, 2304, 2431, 2557, 2680, 2801, 2919, 3034, 3145,
		3251, 3353, 3449, 3540, 3625, 3704, 3776, 3842, 3900, 3951,
		3995, 4031, 4059, 4079, 4091, 4095, 4091, 4079, 4059, 4031,
		3995, 3951, 3900, 3842, 3776, 3704, 3625, 3540, 3449, 3353,
		3251, 3145, 3034, 2919, 2801, 2680, 2557, 2431, 2304, 2176,
		2048, 1919, 1791, 1664, 1538, 1415, 1294, 1176, 1061, 950,
		844, 742, 646, 555, 470, 391, 319, 253, 195, 144,
		100, 64, 36, 16, 4, 0, 4, 16, 36, 64,
		100, 144, 195, 253, 319, 391, 470, 555, 646, 742,
		844, 950, 1061, 1176, 1294, 1415, 1538, 1664, 1791, 1919};

//Chamando as funções
void questao1(void);
void questao2(void);
void questao3(void);
void questao4(void);
void questao5(void);

int main(void)
{
	Configure_Clock(); //Configura o clock da placa para sincronizar as funções delay
	Delay_Start();     //Inicia o temporizador interno da placa para ser usado

	//Habilitando os clocks
    RCC->AHB1ENR |= RCC_AHB1ENR_GPIOAEN; //habilita o clock do GPIOA
	RCC->APB1ENR |= RCC_APB1ENR_DACEN;	 //habilita o clock da interface digital do DAC

    //Inicia pino em modo analogico
	GPIOA->MODER |= 0b11 << 8;				//inicialização o pino PA4 no modo analógico
	GPIOA->MODER |= 0b11 << 10;				//inicialização o pino PA4 no modo analógico

	DAC->CR |= DAC_CR_BOFF1;	//desabilita o buffer analógico do DAC1
	DAC->CR |= DAC_CR_EN1;		//habilita o canal 1 do DAC

    //Chamando as funções de cada questão
	//questao1();
	questao2();
	//questao3();
	//questao4();
	//questao5();
}

void questao1()
{
	while(1)
	{
		for(int i=150; i<256; ++i)
		{
			DAC->DHR8R1 = i;	//escreve no DAC1
			Delay_us(30000);	//aguarda para a próxima amostra
		}
		for(int j=255; j>=150; --j)
		{
			DAC->DHR8R1 = j;	//escreve no DAC1
			Delay_us(30000);	//aguarda para a próxima amostra
		}
	}
}

void questao2()
{
    while(1)
    {
	    	for(uint8_t contador=0; contador<200; ++contador)
		{
			DAC->DHR12R1 = samples[contador];	//escreve no DAC1
			Delay_us(100);				//aguarda para a próxima amostra
		}
    }
}

void questao3()
{
    while(1)
    {

    }
}

void questao4()
{
    while(1)
    {

    }
}

void questao5()
{
    while(1)
    {

    }
}

